---
title: "Two group plots"
format: html
---

Simple modeling results for 2 group model with the following parameters:

  n_groups: 2    # residents + HCW
  beta: [[0.1, 0.05], [0.05, 0.3]]
  sigma: 0.25    # 1/latent_duration
  gamma: 0.143   # 1/infectious_duration
  iota: 0.0      # spontaneous infection rate
  N: [78, 22]    # population sizes
  I0: [1, 1]     # initially infected
  dt: 1.0        # model units (one day)
  tf: 200        # total time modeled
  tl: 200        # times the model is evaluated
  n_replicates: 10
  seed: 1

In this model, the force of infection from group 2 > for group 1. So we would expect a higher attack rate among group 2 than group 1 on average. Note that group 1 is larger than group 2, so we would still likely expect more infections total in group 1.

```{python}
import pandas as pd
import altair as alt

# overall cumulative plot
df = pd.read_csv("results_two_group.csv")
df['new_infections'] = df.groupby(['t', 'replicate'])['Y'].transform('sum')
df_total = df.drop_duplicates(subset=['t', 'replicate'])

print(df_total)
chart = alt.Chart(df_total).mark_line().encode(
    x='t:Q',
    y=alt.Y('new_infections:Q', title='Cumulative infections'),
    color='replicate:N'
)

chart.display()
```

```{python}
# overall incidence plot weekly
df = pd.read_csv("results_two_group.csv")
df['incidence'] = df.groupby(['replicate', 'group'])['Y'].diff().fillna(0)
df['week'] = (df['t'] // 7).astype(int)
df_weekly = df.groupby(['week', 'replicate'])['incidence'].sum().reset_index()

chart = alt.Chart(df_weekly).mark_line().encode(
    x='week:Q',
    y='incidence:Q',
    color='replicate:N'
).properties(
)

chart.display()

```


```{python}

df = pd.read_csv("results_two_group.csv")
df_final_ar = df[df['t'] == df['t'].max()]

# group 0 has 78 people and group 1 has 22
df_final_ar.loc[df_final_ar['group'] == 0, 'Y'] /= 78
df_final_ar.loc[df_final_ar['group'] == 1, 'Y'] /= 22

chart = alt.Chart(df_final_ar).mark_boxplot().encode(
    x='group:N',
    y=alt.Y('Y:Q', title='Attack Rate')
).properties(
    width = 300,
    height = 300
)

chart.display()


```

# how to some basic inference with this model

Let's say we have some outbreak that looks like replicate 5 below:

```{python}

# Make some Fake data
fake_outbreak = df[df['replicate'] == 5]
fake_outbreak = fake_outbreak.groupby(['t', 'group'])['Y'].sum().reset_index()
fake_outbreak['day'] = (fake_outbreak['t'] // 1).astype(int)
fake_outbreak = fake_outbreak.groupby(['day'])['Y'].sum().reset_index()

# Create the plot using Altair
chart = alt.Chart(fake_outbreak).mark_line().encode(
    x=alt.X('day:Q', title='Day'),
    y=alt.Y('Y:Q', title='Cumulative Infections')
).properties(
    title='Fake dataset',
    width=600,
    height=400
)

chart.display()

fake_outbreak.to_csv("../data/fake_outbreak.csv", index=False)
```
